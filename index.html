<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="manifest" href="manifest.json">
    <title>M-Chat</title>
    <style>
        <style>
    body { font-family: sans-serif; margin: 0; background: #075E54; color: white; }
    #login-screen { 
        display: flex; flex-direction: column; align-items: center; 
        justify-content: center; height: 100vh; padding: 20px;
    }
    .login-box {
        background: white; padding: 30px; border-radius: 15px;
        display: flex; flex-direction: column; width: 80%; max-width: 300px;
    }
    .login-box input {
        margin-bottom: 15px; padding: 12px; border: 1px solid #ccc;
        border-radius: 8px; color: #333; font-size: 16px;
    }
    .login-box button {
        background: #128C7E; color: white; border: none;
        padding: 12px; border-radius: 8px; font-weight: bold; cursor: pointer;
    }
</style>

<div id="login-screen">
    <div style="font-size: 50px; margin-bottom: 20px;">M</div>
    <div class="login-box">
        <input type="text" id="username" placeholder="Nome de usuário">
        <input type="password" id="password" placeholder="Sua senha">
        <button onclick="fazerLogin()">ENTRAR NO CHAT</button>
    </div>
</div>

</head>
<body>

    <div id="login-screen">
        <h2>Bem-vindo ao M-Chat</h2>
        <input type="text" id="username" placeholder="Seu nome">
        <input type="password" id="password" placeholder="Senha">
        <button onclick="fazerLogin()" style="border-radius: 5px; margin-top: 10px;">Entrar</button>
    </div>

    <div id="chat-screen">
        <div class="header">Conversa Direta</div>
        <div id="messages"></div>
        <div class="input-area">
            <input type="text" id="msgInput" placeholder="Mensagem">
            <button onclick="enviarMensagem()">></button>
        </div>
    </div>

    <script>
        // Verificar se já está logado
        if (localStorage.getItem('logado') === 'true') {
            mostrarChat();
        }

        function fazerLogin() {
    const user = document.getElementById('username').value;
    if (user) {
        localStorage.setItem('logado', 'true');
        localStorage.setItem('nomeUsuario', user);
        
        // ESSAS LINHAS ABAIXO FAZEM A TELA MUDAR:
        document.getElementById('login-screen').style.display = 'none';
        document.getElementById('chat-screen').style.display = 'flex';
        
        conectarSocket();
    } else {
        alert("Por favor, digite seu nome.");
    }
}


        function mostrarChat() {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('chat-screen').style.display = 'flex';
            conectarSocket();
        }

// Lógica do Socket
let socket;

function conectarSocket() {
    // Se você estiver no celular, troque 'localhost' pelo IP do seu PC
    // Exemplo: 'ws://192.168.0.10:8080'
    const endereco = 'ws://localhost:8080'; 

    socket = new WebSocket(endereco);

    socket.onopen = () => {
        console.log("Conectado!");
    };

    socket.onmessage = (event) => {
        const data = JSON.parse(event.data);
        exibirMensagem(data.texto, 'outros');
    };

    socket.onerror = () => {
        alert("Erro: O servidor.js não está rodando no computador!");
    };
}


function fazerLogin() {
    const user = document.getElementById('username').value;
    if (user) {
        localStorage.setItem('logado', 'true');
        localStorage.setItem('nomeUsuario', user);
        
        // MUITO IMPORTANTE: Isso faz a troca visual das telas
        document.getElementById('login-screen').style.display = 'none';
        document.getElementById('chat-screen').style.display = 'flex';
        
        conectarSocket();
    } else {
        alert("Digite um nome!");
    }
}


        function enviarMensagem() {
            const input = document.getElementById('msgInput');
            const texto = input.value;
            if (texto && socket.readyState === WebSocket.OPEN) {
                socket.send(JSON.stringify({ texto: texto, de: localStorage.getItem('nomeUsuario') }));
                exibirMensagem(texto, 'me');
                input.value = '';
            }
        }

        function exibirMensagem(texto, tipo) {
            const div = document.createElement('div');
            div.className = 'msg ' + tipo;
            div.innerText = texto;
            document.getElementById('messages').appendChild(div);
        }
    </script>
</body>
</html>
